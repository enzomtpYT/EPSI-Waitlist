{% extends "base.html" %}

{% block title %}Admin - Modifier Employé{% endblock %}

{% block content %}
<h1>Employé.e : {{ employee.name_employee }} {{ employee.lastname_employee }}</h1>

<div class="manageinfos">
    <div class="admin-section">
        <h2>Modifier les informations de l'employé.e</h2>
        <form action="{{ url_for('employee.edit_employee', id_employee=employee.id_employee) }}" method="post">
            <label for="employee_lastname">Nom :</label>
            <input type="text" id="employee_lastname" name="employee_lastname" value="{{ employee.lastname_employee }}">

            <label for="employee_name">Prénom :</label>
            <input type="text" id="employee_name" name="employee_name" value="{{ employee.name_employee }}">

            <label for="employee_email">E-mail :</label>
            <input type="email" id="employee_email" name="employee_email" value="{{ employee.email_employee }}">

            <label for="employee_role">Rôle de l'employé.e :</label>
            <select id="role" name="role" required>
                {% if user_role == 'superadmin' %}
                <option value="superadmin" {% if employee_role == 'superadmin' %}selected{% endif %}>Superadmin</option>
                <option value="admin" {% if employee_role == 'admin' %}selected{% endif %}>Admin</option>
                <option value="employee" {% if employee_role == 'employee' %}selected{% endif %}>Employé</option>
                {% elif user_role == 'admin' %}
                <option value="admin" {% if employee_role == 'admin' %}selected{% endif %}>Admin</option>
                <option value="employee" {% if employee_role == 'employee' %}selected{% endif %}>Employé</option>
                {% elif user_role == 'employee' %}
                <option value="employee" {% if employee_role == 'employee' %}selected{% endif %}>Employé</option>
                {% endif %}
            </select>

            <div>
                <button type="button" onclick="newuser({{ employee.id_employee }}, '{{ rpassword }}')">Générer un mot de passe</button>
                <button type="submit">Enregistrer</button>
                    <form action="/admin/manage_employee/{{ employee.id_employee }}/delete" method="post">
                        <button class="delete" type="submit" onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce candidat ?');">Supprimer</button>
                    </form>
            </div>
        </form>
    </div>

<script>
// When button is clicked generate new password for user
function newuser(id, password){
    fetch(`/register/employee/${id}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams({
            'password': password
        })
    })
    .then(() => {
        navigator.clipboard.writeText(password)
        .then(() => alert('Le nouveau mot de passe a été copié dans le presse-papiers.'))
        .catch(err => console.error('Erreur lors de la copie du mot de passe : ', err));
        setTimeout(() => {
            window.location.reload();
        }, 1000);
    })
}
</script>

{% endblock %}